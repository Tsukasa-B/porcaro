<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Porcaro Reward Logic Visualization</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --accent-gold: #fbbf24;  /* Match Reward */
            --accent-green: #34d399; /* Rest Reward */
            --accent-red: #f87171;   /* Penalty */
            --accent-blue: #38bdf8;  /* Target Wave */
            --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-family);
            margin: 0;
            padding: 40px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Header Section */
        header {
            text-align: center;
            margin-bottom: 60px;
            border-bottom: 1px solid #334155;
            padding-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin: 0;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-sub);
            font-size: 1.1rem;
        }

        /* Formula Section */
        .formula-box {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .term { display: inline-block; padding: 5px 10px; border-radius: 6px; margin: 2px; transition: transform 0.2s; cursor: default; }
        .term:hover { transform: scale(1.05); }
        .t-match { color: var(--accent-gold); border: 1px solid var(--accent-gold); }
        .t-rest { color: var(--accent-green); border: 1px solid var(--accent-green); }
        .t-bad { color: var(--accent-red); border: 1px solid var(--accent-red); }

        /* Scenarios Section */
        .section-title {
            font-size: 1.5rem;
            border-left: 5px solid var(--accent-blue);
            padding-left: 15px;
            margin-bottom: 20px;
            margin-top: 50px;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .card h3 { margin-top: 0; color: var(--text-main); display: flex; align-items: center; justify-content: space-between;}
        .card-badge { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; color: #000; font-weight: bold; }
        .badge-gold { background-color: var(--accent-gold); }
        .badge-red { background-color: var(--accent-red); }

        /* SVG Graph Styles */
        svg { width: 100%; height: 150px; }
        .axis { stroke: #475569; stroke-width: 1; }
        .target-line { stroke: var(--accent-blue); stroke-width: 2; fill: none; stroke-dasharray: 4; }
        .robot-line { stroke-width: 3; fill: none; }
        .robot-good { stroke: var(--accent-gold); }
        .robot-bad { stroke: var(--accent-red); }
        .label-text { fill: var(--text-sub); font-size: 10px; }

        /* Logic Explanation Grid */
        .logic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .logic-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border-top: 4px solid #fff;
        }
        .lc-match { border-color: var(--accent-gold); }
        .lc-rest { border-color: var(--accent-green); }
        .lc-penalty { border-color: var(--accent-red); }

        .logic-desc { font-size: 0.9rem; color: var(--text-sub); margin-top: 10px; }
        .math-snippet {
            background: #0f172a;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.85rem;
            margin-top: 10px;
            color: #e2e8f0;
        }

        /* Impact Balance Chart */
        .balance-container {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .bar-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .bar-label { width: 150px; font-weight: bold; font-size: 0.9rem; }
        .bar-area { flex-grow: 1; background: #334155; height: 24px; border-radius: 4px; overflow: hidden; position: relative;}
        .bar-fill { height: 100%; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; font-size: 0.8rem; color: #000; font-weight: bold; width: 0; transition: width 1s ease-out; }
        
        .fill-gold { background-color: var(--accent-gold); }
        .fill-green { background-color: var(--accent-green); }
        .fill-red { background-color: var(--accent-red); }

        /* Animation Keyframes */
        @keyframes pulse {
            0% { r: 3; opacity: 0.5; }
            50% { r: 6; opacity: 1; }
            100% { r: 3; opacity: 0.5; }
        }
        .point-marker { animation: pulse 2s infinite; }

        @media (max-width: 768px) {
            .scenario-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Sim-to-Real 報酬設計ビジュアライザー</h1>
        <p class="subtitle">打撃・休符・押し付けを判別する新ロジックの全貌</p>
    </header>

    <!-- Formula Summary -->
    <div class="formula-box">
        <span style="color:#64748b">Total Reward = </span><br><br>
        <span class="term t-match" title="100点: 強さとタイミングが完璧な時">Match (打撃)</span> + 
        <span class="term t-rest" title="0.1点×ステップ数: 待機できている時">Rest (休符)</span> - 
        <span class="term t-bad" title="-5.0点×違反量: 休符で触った時">Viol (違反)</span> - 
        <span class="term t-bad" title="-2.0点×時間: 押し付けた時">Push (押し付け)</span>
    </div>

    <!-- Scenarios -->
    <div class="section-title">1. 打撃判定の比較 (Snap vs Push)</div>
    <div class="scenario-grid">
        
        <!-- Scenario A: Ideal Hit -->
        <div class="card">
            <h3>理想的な打撃 (Virtuoso) <span class="card-badge badge-gold">+100 pts</span></h3>
            <svg viewBox="0 0 300 150">
                <!-- Axes -->
                <line x1="20" y1="130" x2="280" y2="130" class="axis" />
                <line x1="20" y1="10" x2="20" y2="130" class="axis" />
                
                <!-- Target Wave (Gaussian) -->
                <path d="M20,130 Q100,130 130,130 Q150,10 170,130 Q200,130 280,130" class="target-line" />
                
                <!-- Robot Force (Sharp Spike) -->
                <path d="M20,130 L130,130 L150,15 L170,130 L280,130" class="robot-line robot-good" />
                
                <!-- Annotations -->
                <circle cx="150" cy="15" r="5" fill="var(--accent-gold)" class="point-marker"/>
                <text x="160" y="20" fill="var(--accent-gold)" font-weight="bold">HIT!</text>
                <text x="160" y="35" class="label-text">Peak matches Target</text>
                <text x="50" y="145" class="label-text">Time (s)</text>
            </svg>
            <div class="logic-desc">
                <ul>
                    <li>ターゲットの<strong>ピーク(頂点)</strong>で力を発揮。</li>
                    <li>接触時間は 0.1秒未満。</li>
                    <li><strong>Timing Score = 1.0 (満点)</strong></li>
                </ul>
            </div>
        </div>

        <!-- Scenario B: Pushing/Early Hit -->
        <div class="card">
            <h3>悪い例: フライング & 押し付け <span class="card-badge badge-red">0 pts & Penalty</span></h3>
            <svg viewBox="0 0 300 150">
                <!-- Axes -->
                <line x1="20" y1="130" x2="280" y2="130" class="axis" />
                <line x1="20" y1="10" x2="20" y2="130" class="axis" />
                
                <!-- Target Wave (Gaussian) -->
                <path d="M20,130 Q100,130 130,130 Q150,10 170,130 Q200,130 280,130" class="target-line" />
                
                <!-- Robot Force (Early & Flat) -->
                <path d="M20,130 L100,130 L110,40 L200,40 L210,130" class="robot-line robot-bad" />
                
                <!-- Annotations -->
                <rect x="110" y="40" width="90" height="90" fill="rgba(248, 113, 113, 0.2)" />
                <text x="115" y="60" fill="var(--accent-red)" font-weight="bold">Timing Mismatch</text>
                <text x="115" y="80" fill="var(--accent-red)" font-size="10">Target is low here</text>
                <text x="115" y="120" fill="var(--accent-red)" font-weight="bold">PUSH DETECTED</text>
            </svg>
            <div class="logic-desc">
                <ul>
                    <li>波形の立ち上がり(Target=低い)で叩いている。</li>
                    <li><strong>Timing Score ≈ 0.05 (ほぼ0点)</strong></li>
                    <li>接触が長く続き、Match報酬が無効化される。</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Logic Details -->
    <div class="section-title">2. 報酬ロジックの詳細</div>
    <div class="logic-grid">
        <!-- Match Logic -->
        <div class="logic-card lc-match">
            <h4 style="color:var(--accent-gold)">Match Reward (打撃)</h4>
            <div class="logic-desc">
                「力の一致度」と「タイミングの一致度」を掛け合わせることで、ピーク狙いを強制します。
            </div>
            <div class="math-snippet">
                R = Exp(ForceError) × TimingScale<br>
                TimingScale = Target[t] / TargetMax
            </div>
        </div>

        <!-- Rest Logic -->
        <div class="logic-card lc-rest">
            <h4 style="color:var(--accent-green)">Rest Reward (休符)</h4>
            <div class="logic-desc">
                休符の区間（Target < 1.0）で触れていなければ、毎ステップ少しずつ報酬が入ります。
            </div>
            <div class="math-snippet">
                if (Target < 1.0 and NotTouching):<br>
                &nbsp;&nbsp;R += 0.1 (per step)
            </div>
        </div>

        <!-- Penalty Logic -->
        <div class="logic-card lc-penalty">
            <h4 style="color:var(--accent-red)">Penalties (罰)</h4>
            <div class="logic-desc">
                休符中に触れる、または長時間押し付けると大きなペナルティが発生します。
            </div>
            <div class="math-snippet">
                Viol = -5.0 × Force (休符違反)<br>
                Push = -2.0 × TimeOver (押し付け)
            </div>
        </div>
    </div>

    <!-- Impact Analysis -->
    <div class="section-title">3. 報酬バランスの影響度 (1エピソードあたり)</div>
    <div class="balance-container">
        <p style="margin-bottom:20px; color:var(--text-sub);">
            「理想的な1回の打撃」と「ずっと休んでいる場合」のスコア比較。
            エージェントは<strong>「何もしない(40点)」よりも「リスクを冒して叩く(140点)」</strong>を選びます。
        </p>

        <!-- Bar 1: Match Hit -->
        <div class="bar-group">
            <div class="bar-label">1回の打撃成功</div>
            <div class="bar-area">
                <div class="bar-fill fill-gold" style="width: 70%">100 pts (Weight: 100)</div>
            </div>
        </div>

        <!-- Bar 2: Rest Accumulation -->
        <div class="bar-group">
            <div class="bar-label">休符の積算(全編)</div>
            <div class="bar-area">
                <div class="bar-fill fill-green" style="width: 28%">~40 pts (Weight: 0.1 × 400steps)</div>
            </div>
        </div>

        <!-- Bar 3: Penalty Risk -->
        <div class="bar-group">
            <div class="bar-label">強い押し付け(1秒)</div>
            <div class="bar-area">
                <div class="bar-fill fill-red" style="width: 90%">-100 pts Over (Catastrophic)</div>
            </div>
        </div>
    </div>

</div>

<script>
    // Simple animation trigger on load
    window.onload = function() {
        const bars = document.querySelectorAll('.bar-fill');
        const widths = ['70%', '28%', '90%']; // Original target widths
        
        bars.forEach((bar, index) => {
            // Reset to 0 first (already in CSS)
            setTimeout(() => {
                bar.style.width = widths[index];
            }, 300 + (index * 200));
        });
    };
</script>

</body>
</html>