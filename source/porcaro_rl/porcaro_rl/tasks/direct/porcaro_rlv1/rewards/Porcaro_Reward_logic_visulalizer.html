<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Porcaro RL: Detailed Reward Architecture</title>
    
    <!-- â˜…è¿½åŠ : MathJaxã«ã‚ˆã‚‹æ•°å¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>

    <style>
        :root {
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --accent-primary: #3b82f6; /* Blue */
            --accent-success: #10b981; /* Green */
            --accent-danger: #ef4444;  /* Red */
            --accent-warn: #f59e0b;    /* Amber */
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --border-color: #334155;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 40px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: auto auto;
            gap: 30px;
        }

        header {
            grid-column: 1 / -1;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
        }

        h1 { margin: 0; font-size: 2.2rem; color: var(--accent-primary); }
        .subtitle { color: var(--text-sub); font-size: 1.1rem; margin-top: 5px; }

        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .section-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .section-title h2 { margin: 0; font-size: 1.5rem; }
        .badge {
            background: rgba(255,255,255,0.1);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* --- Match Reward Details --- */
        .match-card { grid-row: span 2; }
        .match-badge { background: var(--accent-primary); color: white; }

        .viz-container {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        /* SVG Graph Styles */
        .graph-line {
            fill: none;
            stroke: var(--accent-success);
            stroke-width: 3;
            filter: drop-shadow(0 0 8px rgba(16, 185, 129, 0.4));
        }
        .graph-axis { stroke: var(--text-sub); stroke-width: 1; }
        .graph-label { fill: var(--text-sub); font-size: 12px; }
        .graph-target-line {
            stroke: var(--accent-warn);
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        .logic-flow {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .logic-step {
            display: flex;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            overflow: hidden;
            border-left: 4px solid var(--border-color);
        }

        .logic-step.primary { border-color: var(--accent-primary); }
        .logic-step.success { border-color: var(--accent-success); }

        .step-icon {
            width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.1);
            font-size: 1.5rem;
        }

        .step-content { padding: 15px; flex: 1; }
        .step-title { font-weight: bold; color: var(--text-main); display: block; margin-bottom: 5px; }
        .step-desc { font-size: 0.9rem; color: var(--text-sub); margin: 0; }
        
        /* MathJax adjustments */
        mjx-container { font-size: 110% !important; color: #e2e8f0; }

        .param-tag {
            display: inline-block;
            background: #334155;
            color: #cbd5e1;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85rem;
            margin-top: 8px;
        }

        /* --- Rest Reward --- */
        .rest-badge { background: var(--text-sub); color: #1e293b; }
        
        .equation-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            color: var(--accent-success);
            margin: 15px 0;
            border-left: 3px solid var(--accent-success);
        }

        /* --- Penalties --- */
        .penalty-card { align-self: start; }
        .penalty-badge { background: var(--accent-danger); color: white; }

        .penalty-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed var(--border-color);
        }
        .penalty-item:last-child { border-bottom: none; margin-bottom: 0; }

        .penalty-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .penalty-name { font-weight: bold; color: var(--accent-danger); }
        .penalty-weight { font-weight: bold; background: rgba(239,68,68,0.1); color: var(--accent-danger); padding: 2px 8px; border-radius: 4px; }

        /* Responsive */
        @media (max-width: 1024px) {
            .container { grid-template-columns: 1fr; }
            .match-card { grid-row: auto; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Porcaro RL: Reward System Architecture v1.2</h1>
            <div class="subtitle">åˆæœŸå­¦ç¿’ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆActive Explorationï¼‰å‘ã‘ï¼šç·©å’Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šä»•æ§˜æ›¸</div>
        </header>

        <!-- å·¦ã‚«ãƒ©ãƒ : Match Reward (ãƒ¡ã‚¤ãƒ³) -->
        <div class="card match-card">
            <div class="section-title">
                <h2>ğŸ”¥ Match Reward (æ‰“æ’ƒå ±é…¬)</h2>
                <span class="badge match-badge">Weight: 100.0</span>
            </div>

            <p style="color: var(--text-sub); margin-bottom: 20px;">
                ãƒ­ãƒœãƒƒãƒˆãŒæœ€ã‚‚å„ªå…ˆã™ã¹ãç›®æ¨™ã€‚ãƒ‰ãƒ©ãƒ ã¸ã®æ¥è§¦çµ‚äº†æ™‚ï¼ˆFalling Edgeï¼‰ã«1å›ã ã‘è¨ˆç®—ã•ã‚Œã‚‹ã‚¹ãƒ‘ãƒ¼ã‚¹å ±é…¬ã€‚
                ç¾åœ¨ã¯å­¦ç¿’åˆæœŸã®ãŸã‚ã€ã€Œå¼·ã„åŠ›ã€ã‚ˆã‚Šã‚‚ã€Œæ¥è§¦ã™ã‚‹ã“ã¨ã€ã‚’å„ªå…ˆã—ã¦è©•ä¾¡ã™ã‚‹è¨­å®šã«ãªã£ã¦ã„ã‚‹ã€‚
            </p>

            <!-- ã‚°ãƒ©ãƒ•ã«ã‚ˆã‚‹å¯è¦–åŒ– -->
            <div class="viz-container">
                <div style="margin-bottom: 10px; font-weight:bold; color:var(--accent-success);">Force Score Distribution (åŠ›ã®è©•ä¾¡é–¢æ•°)</div>
                <svg width="100%" height="200" viewBox="0 0 600 200">
                    <!-- Grid -->
                    <line x1="50" y1="180" x2="550" y2="180" class="graph-axis" />
                    <line x1="300" y1="20" x2="300" y2="180" class="graph-target-line" />
                    
                    <!-- Curve: exp(-|x - 20| / 15) -->
                    <!-- Points approximated for visual representation -->
                    <path d="M 50 178 Q 150 170 200 120 T 300 20 T 400 120 T 550 178" class="graph-line" fill="none" />
                    
                    <!-- Labels -->
                    <text x="300" y="195" text-anchor="middle" class="graph-label">Target Force (20N)</text>
                    <text x="50" y="195" text-anchor="middle" class="graph-label">0N</text>
                    <text x="550" y="195" text-anchor="middle" class="graph-label">40N</text>
                    
                    <!-- Annotations -->
                    <text x="310" y="40" fill="#f59e0b" font-size="14">Perfect (1.0)</text>
                    <text x="420" y="110" fill="#94a3b8" font-size="12">Acceptable Range</text>
                    <text x="420" y="125" fill="#10b981" font-weight="bold" font-size="14">Sigma = 15.0</text>
                </svg>
                <div style="font-size: 0.85rem; color: var(--text-sub); margin-top: 10px;">
                    è¨±å®¹èª¤å·®(Sigma)ã‚’ <b>15.0</b> ã«è¨­å®šã—ã¦ã„ã‚‹ãŸã‚ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ(20N)ã«å¯¾ã—ã¦ 5Nã€œ35N ã®åºƒç¯„å›²ã§é«˜å¾—ç‚¹ãŒå¾—ã‚‰ã‚Œã‚‹ï¼ˆé‡£é˜ãŒæ¨ªã«åºƒã„ï¼‰ã€‚
                </div>
            </div>

            <!-- è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ -->
            <h3>Calculation Logic Step-by-Step</h3>
            <div class="logic-flow">
                
                <div class="logic-step primary">
                    <div class="step-icon">ğŸ’ª</div>
                    <div class="step-content">
                        <span class="step-title">1. Force Accuracy (åŠ›ã®æ­£ç¢ºæ€§)</span>
                        <div class="step-desc">
                            ãƒ”ãƒ¼ã‚¯åŠ› $F_{peak}$ ã¨ç›®æ¨™åŠ› $F_{target}$ ã®èª¤å·®ã‚’è©•ä¾¡ã€‚<br>
                            èª¤å·®ãŒå¤§ããã¦ã‚‚ç‚¹æ•°ãŒã‚¼ãƒ­ã«ãªã‚‰ãªã„ã‚ˆã†ã€æŒ‡æ•°é–¢æ•° $\exp$ ã‚’ä½¿ç”¨ã€‚
                            $$ S_{force} = \exp \left( - \frac{|F_{peak} - F_{target}|}{\sigma_{force}} \right) $$
                        </div>
                        <span class="param-tag">Sigma = 15.0</span>
                        <span class="param-tag">Target = 20.0N</span>
                    </div>
                </div>

                <div class="logic-step primary">
                    <div class="step-icon">â±ï¸</div>
                    <div class="step-content">
                        <span class="step-title">2. Timing Check (ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¤å®š)</span>
                        <div class="step-desc">
                            <strong>ã€ç¾åœ¨ï¼šç·©å’Œãƒ¢ãƒ¼ãƒ‰ã€‘</strong><br>
                            æ³¢å½¢ã®å½¢çŠ¶ä¸€è‡´ã§ã¯ãªãã€ã€Œãƒªã‚ºãƒ åŒºé–“å†…ã‹ã©ã†ã‹ã€ã®äºŒå€¤åˆ¤å®šã‚’æ¡ç”¨ã€‚<br>
                            ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ³¢å½¢ãŒ 0.05 ä»¥ä¸Šãªã‚‰ã€ã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚‚æº€ç‚¹ã¨ã™ã‚‹ã€‚
                            $$ M_{timing} = \begin{cases} 1.0 & (\text{if } T_{wave} > 0.05) \\ 0.0 & (\text{otherwise}) \end{cases} $$
                        </div>
                        <span class="param-tag">Logic: Binary (0 or 1)</span>
                        <span class="param-tag">Threshold > 0.05</span>
                    </div>
                </div>

                <div class="logic-step success">
                    <div class="step-icon">ğŸ†</div>
                    <div class="step-content">
                        <span class="step-title">3. Final Score</span>
                        <div class="step-desc">
                            ä¸Šè¨˜2ã¤ã®å€¤ã‚’æ›ã‘åˆã‚ã›ã€é‡ã¿ã‚’ä¹—ç®—ã€‚<br>
                            $$R = 100.0 \times S_{force} \times M_{timing}$$
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- å³ã‚«ãƒ©ãƒ ä¸Š: Rest Reward -->
        <div class="card">
            <div class="section-title">
                <h2>ğŸ’¤ Rest Reward</h2>
                <span class="badge rest-badge">Weight: 0.005</span>
            </div>
            <p style="font-size: 0.9rem; color: var(--text-sub);">
                ã€Œä¼‘ç¬¦ã€ã‚’å®ˆã‚‹ï¼ˆè§¦ã‚Œãªã„ï¼‰è¡Œå‹•ã¸ã®å ±é…¬ã€‚
                æ‰“æ’ƒå ±é…¬(100.0)ã«å¯¾ã—ã¦åœ§å€’çš„ã«å°ã•ãè¨­å®šã—ã€<strong>ã€Œä¼‘ã‚“ã§ç‚¹æ•°ã‚’ç¨¼ãã€æˆ¦ç•¥ã‚’ç„¡åŠ¹åŒ–</strong>ã—ã¦ã„ã‚‹ã€‚
            </p>
            <div class="equation-box">
                IF (Target < 1.0) AND (Force â‰ˆ 0)<br>
                THEN Reward += 0.005
            </div>
            <p style="font-size: 0.85rem; color: #64748b;">
                â€»ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰å…¨ä¼‘ã—ã¦ã‚‚ã€æœ€å¤§ã§ç´„1.6ç‚¹ã«ã—ã‹ãªã‚‰ãªã„è¨­è¨ˆã€‚
            </p>
        </div>

        <!-- å³ã‚«ãƒ©ãƒ ä¸‹: Penalties -->
        <div class="card penalty-card">
            <div class="section-title">
                <h2>âš ï¸ Penalties</h2>
                <span class="badge penalty-badge">Violations</span>
            </div>

            <div class="penalty-item">
                <div class="penalty-header">
                    <span class="penalty-name">1. Rest Violation (ä¼‘ç¬¦ç„¡è¦–)</span>
                    <span class="penalty-weight">-5.0 Ã— Force</span>
                </div>
                <p style="font-size: 0.9rem; color: var(--text-sub); margin: 0;">
                    ä¼‘ç¬¦åŒºé–“ã«èª¤ã£ã¦æ¥è§¦ã—ãŸå ´åˆã€ãã®<strong>åŠ›ã®å¼·ã•ã«æ¯”ä¾‹</strong>ã—ã¦ç½°ã‚’ä¸ãˆã‚‹ã€‚
                    è»½ãè§¦ã‚ŒãŸã ã‘ãªã‚‰æ¸›ç‚¹ã¯å°ã•ã„ã€‚
                    $$ p_{viol} = \frac{F_{current}}{10.0} $$
                </p>
            </div>

            <div class="penalty-item">
                <div class="penalty-header">
                    <span class="penalty-name">2. Pushing (æŠ¼ã—ä»˜ã‘)</span>
                    <span class="penalty-weight">-1.0 / step</span>
                </div>
                <p style="font-size: 0.9rem; color: var(--text-sub); margin: 0;">
                    é€£ç¶šæ¥è§¦æ™‚é–“ãŒé–¾å€¤ã‚’è¶…ãˆãŸå ´åˆã«ç™ºå‹•ã€‚<br>
                    <span class="param-tag" style="background:#451a1a; color:#fca5a5;">Limit: 0.06 sec</span>
                </p>
            </div>

            <div class="penalty-item">
                <div class="penalty-header">
                    <span class="penalty-name">3. Joint Limits (å¯å‹•åŸŸ)</span>
                    <span class="penalty-weight">-1.0 / deg</span>
                </div>
                <p style="font-size: 0.9rem; color: var(--text-sub); margin: 0;">
                    æ‰‹é¦–ãƒ»ã‚°ãƒªãƒƒãƒ—ãŒè¨­è¨ˆå¯å‹•åŸŸã‚’è¶…ãˆãŸè§’åº¦ã«å¯¾ã—ã¦ç·šå½¢ã«ç½°å‰‡ã€‚
                </p>
            </div>
        </div>

    </div>

</body>
</html>